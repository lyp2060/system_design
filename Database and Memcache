migration: SQL needs to run migration scripts if you add one more column,
No SQL, is not schema format, no need to do that 

查询功能是用的最多的,for example, you look at your friends' profile 


注册时写请求
登入， 有时候是写请求，确定上次是什么时候登入的

QPS 决定存储系统的选择

mySQL:1K QPS. 实际中100 左右

mongoDB/Casssandra: 10K QPS 
can use range queries

Redis--》 支持数据持久化
Memcached: 100k-1m QPS ---》 断电了就没了
 基于内存，只能给定ID，才能给结果
 only works for key-value, no range queries 
 
 service:
 those mapping to 3 tables in SQL
 1. authservice
 2. userservice
 3. friendshipservice
 
 一个读多写少的系统，一定要用cache 进行优化
 
 
 browser cache: local storage, 静态文件的cache , 比如说图片
 
 cookie 不是cache, 每次request网站，都会查cookie, 会越来越慢
 
  CDN is cache too, in network side 
  
 cache always in db?
 no, can be used in frontend, browser too
 
 broswers use hash value to identify if the content is different, if different, browser is forced to re-download 
 

 
 memcached:
 一款负责帮你cache在内存里的软件，非常广泛使用在数据库系统中
 
 cache 有ttl, 有淘汰机制
 
  database, cache, web service 可能在3 个机器上
  
 cache and db maybe on differnet machines
 
 if the first operation failed, the whole operation will re-do, no issues
 issue is if the first operation is succesful, the second operation failed 
 
 A: database.set(user), cache.set(key,user)： if database失败，cache 里会有脏数据
 B: cache.set(key,user), database.set(user)： same as A
 C:cache.delete(key,user),database.set(user)， sometimeuse, no dirty data 
 D: database.set(user),cache.delete(key,user), will have dirty data  if cannt delete cache 
 
 严格说都错, C 中，当同时有很多用户访问database, 会出现race condition, facebook didnot use this way
 for example:
 
 def getUser(self,user_id):
  key = 'user::%s' %user_id
  user = cache.get(key)
  if user:
   return user
  user = database.get(user_id)
  cache.set(key,user)
  return user
  
 def setUser(self, user):
  key = 'user::%s" %user.id
  cache.delete(key)
  database.set(user)
  
 if in setUser function, after getUser get(user_id), another people use setuesr function to delete and databa.set , this will make cache has dirty data
 

 
 session table 存在serve端， 
 session_key, user_id, expire_at (默认3个月过期）
 
 session key, it was generated by web server, the hash value is unique.
 返回给浏览器，浏览器存在cookie 中， 一个用户有时候session 有多个，可能在safali 登入，也在chrome登入
 session table:
 session_key string
 user_id: foreign key
 expire_at: timestamp
 
 logout: 
 session table to delete the users session info 
 
 session_table 存在缓存，或者数据库 （--》比较多，但要用cache去优化）
 
 redis： cache thru 
 web server ->[ cache-->DB]: redis has cache and DB together 
 
 cache aside: 
 web server -> cache
          --->DB
 
 
 
 
